{"version":3,"sources":["Map.tsx","Geolocated.jsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["DEFAULT_FILL","WRONG_FILL","CORRECT_FILL","shuffle","a","i","length","j","Math","floor","random","Map","useState","missed","setMissed","neighbToFind","setNeighb","data","features","map","d","properties","name","slice","allNeighbs","setAllNeighbs","rootRef","useMemo","createRef","tooltipRef","useRef","svg","nextNeighb","useCallback","alert","useEffect","d3","on","includes","filter","dd","each","el","this","style","insert","attr","text","misses","concat","console","log","current","selectAll","eventHandler","useLayoutEffect","ref","append","projection","geoMercator","scale","translate","precision","path","geoPath","bounds","xScale","abs","yScale","transl","enter","id","width","padding","margin","type","onClick","float","JSON","stringify","geolocated","positionOptions","enableHighAccuracy","watchPosition","userDecisionTimeout","props","neighb","coords","lat","latitude","lon","longitude","find","insidePolygon","isGeolocationAvailable","isGeolocationEnabled","window","location","href","substr","replace","App","className","Geolocated","Boolean","hostname","match","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"k/0kBAMMA,EAAe,qBACfC,EAAa,MACbC,EAAe,QAErB,SAASC,EAAQC,GACf,IAAK,IAAIC,EAAID,EAAEE,OAAS,EAAGD,EAAI,EAAGA,IAAK,CACrC,IAAME,EAAIC,KAAKC,MAAMD,KAAKE,UAAYL,EAAI,IADL,EAEtB,CAACD,EAAEG,GAAIH,EAAEC,IAAvBD,EAAEC,GAFkC,KAE9BD,EAAEG,GAF4B,KAIvC,OAAOH,EAIM,SAASO,IAAoB,IAAD,EACbC,mBAAS,IADI,mBAClCC,EADkC,KAC1BC,EAD0B,OAEPF,qBAFO,mBAElCG,EAFkC,KAEpBC,EAFoB,OAGLJ,mBAAST,EAAQc,EAAKC,SAASC,KAAI,SAACC,GAAD,OAAOA,EAAEC,WAAWC,QAAMC,MAAM,EAAG,KAHjE,mBAGlCC,EAHkC,KAGtBC,EAHsB,KAInCC,EAAUC,mBAAQ,kBAAMC,wBAA6B,IACrDC,EAAaC,mBACfC,EAAMD,mBAUV,IAAME,EAAaC,uBAAY,WAC7BjB,EAAUQ,EAAW,IACrBC,EAAcD,EAAWD,MAAM,IACL,IAAtBC,EAAWlB,QACb4B,MAAM,oBAAD,OAA8D,KAAxC,EAAGrB,EAAOP,OAAOW,EAAKC,SAASZ,QAArD,gBAEN,CAACkB,IAoGJ,OA7FAW,qBACE,WACOpB,GA6BLqB,IAAa,QACVC,GAAG,SAAS,SAACjB,GAAD,MAAY,sBAAII,GAAJ,CAAgBT,IAAcuB,SAASlB,EAAEC,WAAWC,MA1B/E,SAAiCF,GAC3BA,EAAEC,WAAWC,OAASP,EACxBqB,IAAa,YAAYG,QAAO,SAACC,GAAD,OAAapB,EAAEC,WAAWC,OAASkB,EAAGnB,WAAWC,QAC9EmB,MAAK,SAASC,GACbN,IAAUO,MAAMC,MAAM,OAAQ1C,GAAc0C,MAAM,UAAW,OAGjER,IAAa,YAAYG,QAAO,SAACC,GAAD,OAAazB,IAAiByB,EAAGnB,WAAWC,QACzEmB,MAAK,SAASC,GACbN,IAAUO,MAAMC,MAAM,OAAQ3C,GAAY2C,MAAM,UAAW,GAC3DR,IAAUO,MAAME,OAAO,QACpBC,KAAK,KAAM,SACXC,KAAKL,EAAGrB,WAAWC,SAE1BR,GAAU,SAACkC,GAAD,OAAYA,EAAOC,OAAOlC,OAEtCmC,QAAQC,IAAIR,MACRZ,EAAIqB,SACNrB,EAAIqB,QAAQC,UAAU,QAAQhB,GAAG,aAAa,WAC5CD,IAAUO,MAAMC,MAAM,UAAW,OAGrCZ,IAIqFsB,CAAalC,GAAK,UAE3G,CAACL,EAAciB,EAAYR,IAG7B+B,2BACE,WAEE,IAAMC,EAAM9B,EAAQ0B,QACpB,GAAKI,EAAL,CAKAzB,EAAIqB,QAAUhB,IAAUoB,GAAKC,OAAO,OAAOX,KAAK,QADpC,KACoDA,KAAK,SAD3C,KAG1B,IAAIY,EAAaC,cAAcC,MAAM,GAAGC,UAAU,CAAC,EAAG,IAAIC,UAAU,GAChEC,EAAOC,cAAUN,WAAWA,GAC5BO,EAASF,EAAKE,OAAOhD,GAErBiD,EAPQ,IAOS1D,KAAK2D,IAAIF,EAAO,GAAG,GAAKA,EAAO,GAAG,IACnDG,EARsB,IAQJ5D,KAAK2D,IAAIF,EAAO,GAAG,GAAKA,EAAO,GAAG,IACpDL,EAAQM,EAASE,EAASF,EAASE,EAEnCC,EAA2B,EAXnB,IAW6BT,GAASK,EAAO,GAAG,GAAKA,EAAO,GAAG,KAAO,GAXxD,IAWqEL,GAASK,EAAO,GAAG,GAAKA,EAAO,GAAG,KAAO,GACxIP,EAAWE,MAAMA,GAAOC,UAAUQ,GAElCtC,EAAIqB,QAAQC,UAAU,QACnBpC,KAAKA,EAAKC,UACVoD,QACAb,OAAO,QACPX,KAAK,IAAKiB,GACVjB,KAAK,WAAW,SAAC1B,GAAD,OAAYA,EAAEmD,MAC9BzB,KAAK,aAAa,SAAC1B,GAAD,OAA2CA,EAAEC,WAAWC,QAC1EwB,KAAK,iBAAkB,OACvBF,MAAM,OAAQ5C,GAAc4C,MAAM,SAAU,WAE/Cb,EAAIqB,QAAQC,UAAU,QAAQhB,GAAG,aAAa,WAC5CD,IAAUO,MAAMC,MAAM,UAAW,OAEnCb,EAAIqB,QAAQC,UAAU,QAAQhB,GAAG,YAAY,WAC3CD,IAAUO,MAAMC,MAAM,UAAW,MAEnCb,EAAIqB,QAAQC,UAAU,QAAQhB,GAAG,cAAc,WAC7CD,IAAUO,MAAMC,MAAM,UAAW,MAEnCM,QAAQC,IAAI,oBAEd,CAACzB,IAGH6B,2BACE,WACO1B,EAAWuB,UACdvB,EAAWuB,QAAUhB,IAAU,QAAQqB,OAAO,OAC7CX,KAAK,QAAS,WACdF,MAAM,UAAW,MAGtB,IAGA,yBAAKA,MAAO,CAAC4B,MAAO,QAASC,QAAS,OAAQC,OAAQ,cACpD,4BAAQC,KAAK,SAASC,QAnH1B,WACEnD,EAActB,EAAQc,EAAKC,SAASC,KAAI,SAACC,GAAD,OAAOA,EAAEC,WAAWC,QAAMC,MAAM,EAAG,KAC3ET,EAAU,IACVsB,IAAa,YAAYQ,MAAM,OAAQ5C,GAAc4C,MAAM,SAAU,WACrEZ,MA+GE,kBACEjB,GAAgB,6BAChB,6BAAK,wDAA8BA,EAA9B,MACL,6BAAK,4BAAQ4D,KAAK,SAASC,QAvGjC,WACE5D,EAAUQ,EAAW,IACrBC,EAAcD,EAAWD,MAAM,GAAG0B,OAAOlC,MAqGhC,8BAEP,2BAAO6B,MAAO,CAACiC,MAAO,UACpB,8CACA,6BAAMC,KAAKC,UAAUlE,EAAQ,KAAM,KAErC,yBAAK2C,IAAK9B,K,oBCnJVT,E,MAmCS+D,2BAAW,CACxBC,gBAAiB,CACfC,oBAAoB,GAEtBC,eAAe,EACfC,oBAAqB,KALRJ,EAjCf,SAAcK,GAAQ,IAAD,EACSzE,qBADT,mBACZ0E,EADY,KACJtE,EADI,OAEuBqE,EAAME,QAAU,GAAxCC,EAFC,EAEXC,SAA0BC,EAFf,EAEIC,UAavB,OAZAxD,qBACE,WACE,GAAIqD,EAAK,CACP,IAAMF,EAASrE,EAAK2E,MAAK,SAACxE,GAAD,OAAOyE,wBAAc,CAACL,EAAKE,GAAMtE,EAAC,aAEvDkE,GACFtE,EAAUsE,EAAOhE,SAIvB,CAACkE,EAAKE,IAEAL,EAAMS,uBAETT,EAAMU,qBAELV,EAAME,OACJD,EAEI,6BACA,qDAA2BA,IAI3B,4FAEJ,iEAXF,2DAFF,6ECjBoC,UAArCU,OAAOC,SAASC,KAAKC,OAAO,EAAE,KAC/BH,OAAOC,SAASC,KAAOF,OAAOC,SAASC,KAAKE,QAAQ,OAAQ,UAKhE,IAWeC,EAXO,WACpB,OACE,yBAAKC,UAAU,OACb,6BACE,kBAACC,EAAD,MACA,kBAAC5F,EAAD,SCLY6F,QACW,cAA7BR,OAAOC,SAASQ,UAEe,UAA7BT,OAAOC,SAASQ,UAEhBT,OAAOC,SAASQ,SAASC,MACvB,2DCZNC,IAASC,OAAO,kBAAC,EAAD,MAASC,SAASC,eAAe,SDmI3C,kBAAmBC,WACrBA,UAAUC,cAAcC,MAAMC,MAAK,SAAAC,GACjCA,EAAaC,kB","file":"static/js/main.44d62407.chunk.js","sourcesContent":["import * as d3 from 'd3';\nimport { Selection } from 'd3';\nimport { geoMercator, geoPath } from 'd3-geo';\nimport React, { useEffect, createRef, useState, useLayoutEffect, useRef, useMemo, useCallback } from 'react';\nimport data from './geojson.json';\n\nconst DEFAULT_FILL = 'rgb(175, 157, 150)';\nconst WRONG_FILL = 'red';\nconst CORRECT_FILL = 'green';\n\nfunction shuffle(a: string[]): string[] {\n  for (let i = a.length - 1; i > 0; i--) {\n    const j = Math.floor(Math.random() * (i + 1));\n    [a[i], a[j]] = [a[j], a[i]];\n  }\n  return a;\n}\n\n\nexport default function Map(): JSX.Element {\n  const [missed, setMissed] = useState([]);\n  const [neighbToFind, setNeighb] = useState();\n  const [allNeighbs, setAllNeighbs] = useState(shuffle(data.features.map((d) => d.properties.name).slice(0, 5)));\n  const rootRef = useMemo(() => createRef<HTMLDivElement>(), []);\n  const tooltipRef = useRef<Selection<HTMLDivElement, unknown, HTMLElement, any>>();\n  let svg = useRef<Selection<SVGSVGElement, unknown, null, undefined>>();\n\n\n  function startGame() {\n    setAllNeighbs(shuffle(data.features.map((d) => d.properties.name).slice(0, 5)));\n    setMissed([]);\n    d3.selectAll('svg path').style(\"fill\", DEFAULT_FILL).style(\"stroke\", \"#ffffff\");\n    nextNeighb();\n  }\n\n  const nextNeighb = useCallback(function nextNeighb() {\n    setNeighb(allNeighbs[0]);\n    setAllNeighbs(allNeighbs.slice(1));\n    if (allNeighbs.length === 0) {\n      alert(`game done. Score ${(1-(missed.length/data.features.length))*100}% correct`);\n    }\n  }, [allNeighbs])\n\n  function skip() {\n    setNeighb(allNeighbs[0]);\n    setAllNeighbs(allNeighbs.slice(1).concat(neighbToFind));\n  }\n\n  useEffect(\n    () => {\n      if (!neighbToFind) {\n        return;\n      }\n\n      function eventHandler(this: any, d: any) {\n        if (d.properties.name === neighbToFind) {\n          d3.selectAll('svg path').filter((dd: any) => d.properties.name === dd.properties.name)\n            .each(function(el){\n              d3.select(this).style('fill', CORRECT_FILL).style('opacity', 1);\n            })\n        } else {\n          d3.selectAll('svg path').filter((dd: any) => neighbToFind === dd.properties.name)\n            .each(function(el: any){\n              d3.select(this).style('fill', WRONG_FILL).style('opacity', 1);\n              d3.select(this).insert('text')\n                .attr('dy', '0.5em')\n                .text(el.properties.name);\n            })\n          setMissed((misses) => misses.concat(neighbToFind));\n        }\n        console.log(this);\n        if (svg.current) {\n          svg.current.selectAll('path').on('mouseover', function() {\n            d3.select(this).style('opacity', 0.5);\n          });\n        }\n        nextNeighb();\n      }\n\n      d3.selectAll('path')\n        .on('click', (d: any) => [...allNeighbs, neighbToFind].includes(d.properties.name) ? eventHandler(d) : null );\n    },\n    [neighbToFind, nextNeighb, allNeighbs]\n  )\n\n  useLayoutEffect(\n    () => {\n      \n      const ref = rootRef.current;\n      if (!ref) {\n        return;\n      }\n\n      var width = 600, height = 600;\n      svg.current = d3.select(ref).append(\"svg\").attr(\"width\", width).attr(\"height\", height);\n\n      var projection = geoMercator().scale(1).translate([0, 0]).precision(0);\n      var path = geoPath().projection(projection);\n      var bounds = path.bounds(data as any);\n\n      let xScale = width / Math.abs(bounds[1][0] - bounds[0][0]);\n      let yScale = height / Math.abs(bounds[1][1] - bounds[0][1]);\n      let scale = xScale < yScale ? xScale : yScale;\n\n      var transl: [number, number] = [(width - scale * (bounds[1][0] + bounds[0][0])) / 2, (height - scale * (bounds[1][1] + bounds[0][1])) / 2];\n      projection.scale(scale).translate(transl);\n\n      svg.current.selectAll(\"path\")\n        .data(data.features)\n        .enter()\n        .append(\"path\")\n        .attr(\"d\", path as any)\n        .attr('data-id', (d: any) => d.id)\n        .attr('data-name', (d: { properties: { name: string; }; }) => d.properties.name)\n        .attr('pointer-events', 'all')\n        .style(\"fill\", DEFAULT_FILL).style(\"stroke\", \"#ffffff\");\n\n      svg.current.selectAll('path').on('mouseover', function() {\n        d3.select(this).style('opacity', 0.5);\n      });\n      svg.current.selectAll('path').on('touchend', function() {\n        d3.select(this).style('opacity', 1);\n      });\n      svg.current.selectAll('path').on('mouseleave', function() {\n        d3.select(this).style('opacity', 1);\n      });\n      console.log('layout effect')\n    },\n    [rootRef]\n  );\n\n  useLayoutEffect(\n    () => {\n      if (!tooltipRef.current) {\n        tooltipRef.current = d3.select(\"body\").append(\"div\")\t\n        .attr(\"class\", \"tooltip\")\t\t\t\t\n        .style(\"opacity\", 0);\n      }\n    },\n    []\n  )\n  return (\n    <div style={{width: '900px', padding: '30px', margin: 'auto auto'}}>\n      <button type=\"button\" onClick={startGame}>Start New Game</button>\n      { neighbToFind && <div>\n        <div><p>Can you find and click on {neighbToFind}?</p></div>\n        <div><button type=\"button\" onClick={skip}>Skip and come back later</button></div>\n        </div>}\n      <aside style={{float: 'right'}}>\n        <h4>Missed Neighbs</h4>\n        <pre>{JSON.stringify(missed, null, 2)}</pre>\n      </aside>\n      <div ref={rootRef}/>\n    </div>\n  );\n}","import React, { useEffect, useState } from 'react';\nimport {geolocated } from 'react-geolocated';\nimport { insidePolygon } from 'geolocation-utils';\nimport _data from './data.json';\n\nconst data = _data;\n\nfunction Demo(props) {\n  const [neighb, setNeighb] = useState();\n  const { latitude: lat, longitude: lon } = props.coords || {};\n  useEffect(\n    () => {\n      if (lat) {\n        const neighb = data.find((d) => insidePolygon([lat, lon], d['the_geom'] ));\n        debugger;\n        if (neighb) {\n          setNeighb(neighb.name);\n        }\n      }\n    },\n    [lat, lon]\n  )\n  return !props.isGeolocationAvailable\n    ? <div>Your browser does not support Geolocation</div>\n    : !props.isGeolocationEnabled\n      ? <div>Geolocation is not enabled</div>\n      : props.coords\n        ? neighb \n            ? (\n              <div>\n              <h3>Current Neigbourhood: {neighb}</h3>\n              </div>\n            )\n            : (\n              <div>Could not find current neighbourhood.  Are you in the city?</div>\n            )\n        : <div>Getting the location data&hellip; </div>;\n}\n\n\nexport default geolocated({\n  positionOptions: {\n    enableHighAccuracy: true,\n  },\n  watchPosition: true,\n  userDecisionTimeout: 5000,\n})(Demo);","import React from 'react';\nimport './App.css';\nimport Map from './Map';\nimport Geolocated from './Geolocated';\n\nif (process.env.NODE_ENV === 'production') {\n  if(window.location.href.substr(0,5) !== 'https'){\n    window.location.href = window.location.href.replace('http', 'https');\n  }\n}\n\n\nconst App: React.FC = () => {\n  return (\n    <div className=\"App\">\n      <div>\n        <Geolocated />\n        <Map />\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}